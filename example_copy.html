<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

  <style>
body {font-family: "Lato", sans-serif;}

.sidebar {
  height: 100%;
  width: 160px;
  z-index: 1;
  top: 0;
  left: 0;
  background-color: #111;
  overflow-x: hidden;
  padding-top: 16px;
}

.sidebar a {
  padding: 6px 8px 6px 16px;
  text-decoration: none;
  font-size: 20px;
  color: #818181;
  display: block;
}

.sidebar a:hover {
  color: #f1f1f1;
}

.main {
  margin-left: 160px; /* Same as the width of the sidenav */
  padding: 0px 10px;
}

@media screen and (max-height: 450px) {
  .sidebar {padding-top: 15px;}
  .sidebar a {font-size: 18px;}
}

#touchHolder{
    position: absolute;
    width:10px;
    height:10px;
    background-color: #f00;
}

.validDropTargetMoj{
}

.dropbox{
	height: 200px;
	width: 200px;
	border:1px solid grey;
	display: inline-block;
	position: relative;
}
.absolute {
	position: absolute;
}
#draggable {
    height:150px;
    width:150px;
    background-color:#ccc;
}







</style>

</head>

<body >

<div id='bud' class="sidebar">
  <a href="#home"><i class="fa fa-fw fa-home"></i> Home</a>
  <a href="#services"><i class="fa fa-fw fa-wrench"></i> Services</a>
  <a href="#clients"><i class="fa fa-fw fa-user"></i> Clients</a>
  <a href="#contact"><i class="fa fa-fw fa-envelope"></i> Contact</a>
</div>

<div class="main">
  <h2>Sidebar with Icons</h2>
  <p>This side navigation is of full height (100%) and always shown.</p>
  <p>Lorem ipsum dolor sit amet, illum definitiones no quo, maluisset concludaturque et eum, altera fabulas ut quo. Atqui causae gloriatur ius te, id agam omnis evertitur eum. Affert laboramus repudiandae nec et. Inciderint efficiantur his ad. Eum no molestiae voluptatibus.</p>
  <p>He said the clash occurred at a time when tension had been easing after India demolished infrastructure it had built on the Chinese side of the LAC in May and withdrew personnel, following an agreement between Chinese and Indian officers.</p>
  <p>This side navigation is of full height (100%) and always shown.</p>
  <p>Lorem ipsum dolor sit amet, illum definitiones no quo, maluisset concludaturque et eum, altera fabulas ut quo. Atqui causae gloriatur ius te, id agam omnis evertitur eum. Affert laboramus repudiandae nec et. Inciderint efficiantur his ad. Eum no molestiae voluptatibus.</p>
  <p>He said the clash occurred at a time when tension had been easing after India demolished infrastructure it had built on the Chinese side of the LAC in May and withdrew personnel, following an agreement between Chinese and Indian officers.</p>
  <p>This side navigation is of full height (100%) and always shown.</p>
  <p>Lorem ipsum dolor sit amet, illum definitiones no quo, maluisset concludaturque et eum, altera fabulas ut quo. Atqui causae gloriatur ius te, id agam omnis evertitur eum. Affert laboramus repudiandae nec et. Inciderint efficiantur his ad. Eum no molestiae voluptatibus.</p>
  <p>He said the clash occurred at a time when tension had been easing after India demolished infrastructure it had built on the Chinese side of the LAC in May and withdrew personnel, following an agreement between Chinese and Indian officers.</p>
  <p>This side navigation is of full height (100%) and always shown.</p>
  <p>Lorem ipsum dolor sit amet, illum definitiones no quo, maluisset concludaturque et eum, altera fabulas ut quo. Atqui causae gloriatur ius te, id agam omnis evertitur eum. Affert laboramus repudiandae nec et. Inciderint efficiantur his ad. Eum no molestiae voluptatibus.</p>
  <p>He said the clash occurred at a time when tension had been easing after India demolished infrastructure it had built on the Chinese side of the LAC in May and withdrew personnel, following an agreement between Chinese and Indian officers.</p>
  <p>This side navigation is of full height (100%) and always shown.</p>
  <p>Lorem ipsum dolor sit amet, illum definitiones no quo, maluisset concludaturque et eum, altera fabulas ut quo. Atqui causae gloriatur ius te, id agam omnis evertitur eum. Affert laboramus repudiandae nec et. Inciderint efficiantur his ad. Eum no molestiae voluptatibus.</p>
  <p>He said the clash occurred at a time when tension had been easing after India demolished infrastructure it had built on the Chinese side of the LAC in May and withdrew personnel, following an agreement between Chinese and Indian officers.</p>

</div>









<div id="div1" class="dropbox" ondrop="dropMoj(event)" ondragover="allowDropMoj(event)"></div>
<div id="div2" class="dropbox" ondrop="dropMoj(event)" ondragover="allowDropMoj(event)"></div>
<br>
    <div id="draggable" draggable="true" ondragstart="dragMoj(event)" ></div>


    <div id="touchHolder">
    </div>









</body>


<script>


function allowDropMoj(ev) {
    ev.preventDefault();
  }

  function dragMoj(ev) {
    ev.dataTransfer.setData("text", ev.target.id);
  }

  function dropMoj(ev) {
    ev.preventDefault();
    let data = ev.dataTransfer.getData("text");
    console.log('dropped ', ev.target, ' ', document.getElementById(data))
    //ev.target.appendChild(document.getElementById(data));
  }



  var style = document.createElement('style');
  style.innerHTML = `
        img.fixedLike {
          position: fixed;
          bottom: 0;
          left: 0;
        background-color: yellow;
        }
        img.fixedComment {
          position: fixed;
          top: 0;
          left: 0;
        margin-left: 68;
        background-color: yellow;
        }
        img.fixedShare {
          position: fixed;
          bottom: 0;
          right: 0;
        margin-left:136;
        background-color: yellow;
        }
        `

  document.head.appendChild(style);




  const imgLike = document.createElement("img");
    const imgComment = document.createElement("img");
    const imgShare = document.createElement("img");
    imgLike.src = "./likeIcon.png";
    imgLike['draggable']= "true";
    imgLike.addEventListener('dragstart', dragMoj)
    imgLike.id= "dragLike";
    //imgLike.className= "fixedLike";
    imgLike['width']= "64";
    imgLike['height']= "64";

    imgComment.src = "./commentIcon.png";
    imgComment['draggable']= "true";
    imgComment.addEventListener('dragstart', dragMoj)
    imgComment.id= "dragComment";
    //imgComment.className= "fixedComment";
    imgComment['width']= "64";
    imgComment['height']= "64";

    imgShare.src = "./shareIcon.png";
    imgShare['draggable']= "true";
    imgShare.addEventListener('dragstart', dragMoj)
    imgShare.id= "dragShare";
    //imgShare.className= "fixedShare";
    imgShare['width']= "64";
    imgShare['height']= "64";

    document.body.appendChild(imgLike)
    document.body.appendChild(imgComment)
    document.body.appendChild(imgShare)


    console.log(imgLike)
    console.log(document.getElementById('dragLike'))
    console.log(document.getElementById('dragComment'))

    //document.getElementById("dragLike").addEventListener("drag", displayDate);


    /*
        const attrs = term =>{
            let attr = {
                draggable: "true",
                onDragStart: "drag(event)",
                id: "drag"+term,
                className: "fixed"+term,
                width: "64",
                height: "64",
            }
            return attr
        }
        for(let img of [{n:imgLike, w:'Like'}, imgComment, imgShare])
        for(let attr in attrs('Like')) {
            console.log(attr)
            imgLike[attr] = attrs[attr]
            console.log(imgLike)
        }
        for(let attr in attrs('Comment'))
            imgComment[attr]=attrs[attr]
        for(let attr in attrs('Share'))
            imgShare[attr]=attrs[attr]
    */



let modePreTagAllDroppableElements = true
if(modePreTagAllDroppableElements){
    const findElemsWithLargeText = root =>{
        const myfilter= node => {
            if (node.parentNode.tagName == 'SCRIPT')
                return NodeFilter.FILTER_SKIP;

            if (node.data.length>20) //filter out terms less than 20 DIV and IMG elements
                return NodeFilter.FILTER_ACCEPT;

            return NodeFilter.FILTER_SKIP;
        }

        let n
        let a=[] 

        let walk = document.createTreeWalker(
            document.body,
            NodeFilter.SHOW_TEXT,
            myfilter,
            false
        );
        while(n=walk.nextNode()){
            a.push(n);
        }
        
        //Go back to the first child node of the collection and alert it
        walk.currentNode=document.body //reset TreeWalker pointer to point to root node

        return {nodes: a, walk:walk}
    }


    let nodesAndWalk = findElemsWithLargeText(document.body)

    for(n of nodesAndWalk.nodes){
        n.parentNode.addEventListener("drop", dropMoj)
        n.parentNode.addEventListener("dragover", allowDropMoj)
        n.parentNode.className+=" validDropTargetMoj "
    }
    console.log(nodesAndWalk.nodes,'\n-----------------\n')
    console.log(nodesAndWalk.nodes.map(item => item.data))

}






        /* here is where the touch stuff starts*/
    const onTouchMoveParam = (event, draggable) => {
          
            if(!draggable.className.includes(" absolute ")){
                // make the element draggable by giving it an absolute position and modifying the x and y coordinates
                draggable.className = draggable.className + " absolute ";
                // put the draggable into the wrapper, because otherwise the position will be relative of the parent element
                //wrapper.appendChild(draggable);
            }
			var touch = event.targetTouches[0];
			// Place element where the finger is
			draggable.style.left = touch.pageX-25 + 'px';
			draggable.style.top = touch.pageY-25 + 'px';
			event.preventDefault();
    } 

    const onTouchEndParam = (event, draggable) => {
            // MOJ: This is not needed, because we can just get all elements that are under our finger now.
            //hide the draggable element, or the elementFromPoint won't find what's underneath
			//draggable.style.left = '-1000px';
			//draggable.style.top = '-1000px';
			// find the element on the last draggable position
            //let endPoint= {x: event.changedTouches[0].pageX, y: event.changedTouches[0].pageY}
            let endPointViewPort= {x: event.changedTouches[0].clientX, y: event.changedTouches[0].clientY}
            let endPoint= {x: event.changedTouches[0].pageX, y: event.changedTouches[0].pageY}
            console.log("end points are ", endPoint, endPointViewPort)
            let endTargets = document.elementsFromPoint(endPointViewPort.x, endPointViewPort.y);
            console.log("before ", document.getElementById("touchHolder"))
            document.getElementById("touchHolder").style.left=endPoint.x+"px"
            document.getElementById("touchHolder").style.top=endPoint.y+"px"
            console.log("after ", document.getElementById("touchHolder"))
            
            console.log('end targets = ', endTargets)
			// position it relative again and remove the inline styles that aren't needed anymore
			removeClass(draggable, ' absolute ');
            //Moj disabled the line below:
            //draggable.removeAttribute('style');
            // put the draggable into it's new home
            let endTarget = validDropTarget(endTargets)
            console.log('and end target = ', endTarget)
			if (endTarget != null) {
                console.log('dropped ', endTarget, ' ', draggable)
                console.log('vs. dropped ', event.target, ' ', draggable)
                //wrapper.removeChild(draggable);
                //endTarget.appendChild(draggable);
			}
		}

    const validDropTarget = (endTargets) => {
        //returns the first valid drop target from the list of endTargets; else returns none
        for(let endTarget of endTargets){
            if(modePreTagAllDroppableElements){
                if(endTarget.className.includes(" validDropTargetMoj "))
                    return endTarget
            }else{
                if(endTarget.innerHTML.length>20){
                    //TODO: THIS DOESN'T WORK
                    console.log('In validDropTarget, innerHtml=', endTarget.innerHTML)
                    return endTarget
                }
            }
        }
        return null
    }


    const cancelTheTouchDrag = () =>{
        // Here put things that are needed for aborting touch and drop or drag and drop
    }

        /* the drag function */
		imgLike.addEventListener('touchmove', ev=>onTouchMoveParam(ev, imgLike), false);
        imgComment.addEventListener('touchmove', ev=>onTouchMoveParam(ev, imgComment), false);
		imgShare.addEventListener('touchmove', ev=>onTouchMoveParam(ev, imgShare), false);

		/* the drop function */
		imgLike.addEventListener('touchend', ev=>onTouchEndParam(ev, imgLike));
		imgComment.addEventListener('touchend', ev=>onTouchEndParam(ev, imgComment));
		imgShare.addEventListener('touchend', ev=>onTouchEndParam(ev, imgShare));

		// just a little helper function
		function removeClass(e,c) {
			e.className = e.className.replace(
				new RegExp('(?:^|\\s)'+c+'(?!\\S)') ,'');
        }
        

















</script>


</html> 


